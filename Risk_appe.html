{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Appetite</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

<body>

    <section class="main_section">
        <div class="top_header_section">
            <img style="width: 200px;" src="{% static 'assets/images/Group.svg' %}" alt="">
            <h1 class="top_header">Risk Appetite
            </h1>
            <p class="header_text">
                How much risk can you take?
            </p>
        </div>

        <div class="calculator_ui_section">
            <div class="calculator_ui_outer_container">
                <div class="calculator_ui_inner_container">
                    <div id="error-message"></div>
                    
                    <div id="page1">
                        <div class="inputs_container">
                            <div class="input_element">
                                <div class="label_elem_normal">
                                    <div class="label_text">Current Age*</div>
                                </div>
                                <input class="input_tag_normal required" type="number" id="current_age" min="1" max="80" >
                                <div> 
                                    <span class="current-age-error-message" style="color: red; font-size: smaller;"></span>
                                </div>
                            </div>

                            <div class="input_element">
                                <div class="label_elem_normal">
                                    <div class="label_text">Income*</div>
                                </div>
                                <div class="sign_input_container">
                                    <span class="input_rs_sign">₹</span>
                                    <input class="input_tag_with_rs required" type="number" id="income" min="0" max="9999999999" pattern="\d{1,10}">
                                </div>
                                <div> 
                                    <span class="income-error-message" style="color: red; font-size: smaller;"></span>
                                </div>
                            </div>

                            <div class="input_element">
                                <div class="label_elem_normal">
                                    <div class="label_text">Expenses*</div>
                                </div>
                                <div class="sign_input_container">
                                    <span class="input_rs_sign">₹</span>
                                    <input class="input_tag_with_rs required" type="number" id="expenses" min="0" max="9999999999" pattern="\d{1,10}">
                                </div>
                                <div> 
                                    <span class="expense-error-message" style="color: red; font-size: smaller;"></span>
                                </div>
                            </div>

                            <div class="input_element">
                                <div class="label_elem_normal">
                                    <div class="label_text">Investment Amount*</div>
                                </div>
                                <div class="sign_input_container">
                                    <span class="input_rs_sign">₹</span>
                                    <input class="input_tag_with_rs required" type="number" id="investment_amount" min="0" max="9999999999" pattern="\d{1,10}">
                                </div>
                                <div> 
                                    <span class="investment-error-message" style="color: red; font-size: smaller;"></span>
                                </div>
                            </div>
                            
                            <div class="input_element">
                                <div class="label_elem_normal">
                                    <div class="label_text">Dependents*</div>
                                </div>
                                <input class="input_tag_normal required" type="number" id="dependents" min="0" max="99" pattern="\d+">
                                <div> 
                                    <span class="dependents-error-message" style="color: red; font-size: smaller;"></span>
                                </div>
                            </div>

                            <div class="input_element">
                                <div class="label_elem_normal">
                                    <div class="label_text">Tier City*</div>
                                </div>
                                <div class="sign_input_container">
                                    <select class="input_tag required-select" id="tier" name="tier">
                                        <option value="" selected>Select Tier</option>
                                        <option value="tier1">Tier 1</option>
                                        <option value="tier2">Tier 2</option>
                                        <option value="tier3">Tier 3</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div style="width: 200px;margin: 0 auto;">
                            <div class="input_element clc_btn_component">
                                <div class="calculate_btn" onclick="showPage(2)">
                                    Continue
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="page2" style="display: none;">
                        <p class="risk_ques_head">
                            Please answer the following questions about your financial risk tolerance and adaptability.
                        </p>
            
                        <!-- First Question -->
                        <div class="radio_question">
                            <p>1). Compared to others, how do you rate your willingness to take financial risks?</p>
                            <div class="radio_button_option">
                                <input type="radio" name="q1" value="1" id="q1_option1">
                                <label for="veryLowRisk">Very low risk taker</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q1" value="2" id="q1_option2">
                                <label for="lowRisk">Low risk taker</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q1" value="3" id="q1_option3">
                                <label for="averageRisk">Average risk taker</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q1" value="5" id="q1_option4">
                                <label for="highRisk">Extremely high risk taker</label>
                            </div>
                        </div>
            
                        <!-- Second Question -->
                        <div class="radio_question">
                            <p>2). How easily do you adapt when things go wrong financially?</p>
                            <div class="radio_button_option">
                                <input type="radio" name="q2" value="1" id="q2_option1">
                                <label for="veryUneasily">Very uneasily</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q2" value="3" id="q2_option2">
                                <label for="somewhatUneasily">Somewhat uneasily</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q2" value="5" id="q2_option3">
                                <label for="somewhatEasily">Somewhat easily</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q2" value="6" id="q2_option4">
                                <label for="veryEasily">Very easily</label>
                            </div>
                        </div>
            
                        <!-- Third Question -->
                        <div class="radio_question">
                            <p>3). When you think of the word "risk" in a financial context, which of the following words comes to mind first?</p>
                            <div class="radio_button_option">
                                <input type="radio" name="q3" value="1" id="q3_option1">
                                <label for="veryUneasily">Danger</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q3" value="3" id="q3_option2">
                                <label for="somewhatUneasily">Uncertainty</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q3" value="5" id="q3_option3">
                                <label for="somewhatEasily">Opportunity</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q3" value="6" id="q3_option4">
                                <label for="veryEasily">Thrill</label>
                            </div>
                        </div>
            
                        <!-- Fourth Question -->
                        <div class="radio_question">
                            <p>4). If you had to choose between more job security with a small pay increase and less job security with a big pay increase, which would you pick?</p>
                            <div class="radio_button_option">
                                <input type="radio" name="q4" value="1" id="q4_option1">
                                <label for="definitelyMore">Definitely more job security with a small pay increase</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q4" value="2" id="q4_option2">
                                <label for="probablyMore">Probably more job security with a small pay increase</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q4" value="3" id="q4_option3">
                                <label for="notSure">Not sure</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q4" value="4" id="q4_option4">
                                <label for="probablyLess">Probably less job security with a big pay increase</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q4" value="5" id="q4_option5">
                                <label for="definitelyLess">Definitely less job security with a big pay increase</label>
                            </div>
                        </div>
            
                        <!-- Fifth Question -->
                        <div class="radio_question">
                            <p>5). Suppose that 5 years ago you bought stock in a highly regarded company. That same year the company experienced a severe decline in sales due to poor management. The price of the stock dropped drastically and you sold at a substantial loss. The company has been restructured under new management, and most experts now expect it to produce better than average returns. Given your bad past experience with this company, would you buy stock now?</p>
                            <div class="radio_button_option">
                                <input type="radio" name="q5" value="1" id="q5_option1">
                                <label for="definitelyNot">Definitely not</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q5" value="2" id="q5_option2">
                                <label for="probablyNot">Probably not</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q5" value="3" id="q5_option3">
                                <label for="notSureStock">Not sure</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q5" value="4" id="q5_option4">
                                <label for="probablyStock">Probably</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q5" value="5" id="q5_option5">
                                <label for="definitelyStock">Definitely</label>
                            </div>
                        </div>
            
                        <!-- Sixth Question -->
                        <div class="radio_question">
                            <p>6). Investments can go up or down in value, and experts often say you should be prepared to weather a downturn. By how much could the total value of your investments go down before you would begin to feel uncomfortable?</p>
                            <div class="radio_button_option">
                                <input type="radio" name="q6" value="1" id="q6_option1">
                                <label for="anyFall">Any fall in value would make me feel uncomfortable</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q6" value="2" id="q6_option2">
                                <label for="10Percent">10%</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q6" value="2" id="q6_option3">
                                <label for="20Percent">20%</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q6" value="4" id="q6_option4">
                                <label for="33Percent">33%</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q6" value="5" id="q6_option5">
                                <label for="50Percent">50%</label>
                            </div>
            
                            <div class="radio_button_option">
                                <input type="radio" name="q6" value="6" id="q6_option6">
                                <label for="moreThan50Percent">More than 50%</label>
                            </div>
                        </div>
                        
                        <br>
                        <div style="width: 270px;margin: 0 auto;">
                            <div style="display: grid;grid-template-columns: repeat(2, 1fr);gap: 1rem;">
                                <div class="calculate_btn" onclick="showPage(1)">
                                    Back
                                </div>
                                <div class="calculate_btn" onclick="submitForm()">
                                    Calculate
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="page3" style="display: none;">
                        <div style="text-align: center;">
                            <!-- <div style="font-family: Red Hat Text medium;color: #969696;font-size: 1.3rem;">Your Risk
                                Quotient</div> -->
                            <div style="font-family: Red Hat Text medium;color: #000000;font-size: 1.5rem;margin-top: 0.7rem;margin-bottom: 0.5rem;">
                                You are "<span id="output"></span>" Investor
                            </div>
                            <div style="font-family: Red Hat Text regular;color: #969696;font-size: 1rem;padding-right: 1rem;">
                                <p class="risk_desc risk_desc_1">
                                    You are a highly conservative investor who does not wish to take any investment risk. Your priority is to safeguard your investment capital. You are prepared to forego higher returns for peace of mind.
                                </p>
                                <p class="risk_desc risk_desc_2">
                                    You are a conservative investor with some understanding of investment market behaviour. You prefer a balance between capital growth and capital security. You are prepared to accept some short term risk in order to gain longer term capital growth.
                                </p>
                                <p class="risk_desc risk_desc_3">
                                    You are a moderate investor who understands the movement of investment markets. You are most interested in maximising long term capital growth, although you do not wish to make unbalanced investment decisions. You are happy to take calculated risks in order to maximise long term capital growth. Tax advantaged investments are a focus.
                                </p>
                                <p class="risk_desc risk_desc_4">
                                    You are an aggressive investor with a strong bias towards investments with high growth potential. You are willing to accept higher performance fluctuations in return for potentially higher long term capital growth. You also have a greater focus on tax advantaged investments and/or leverage of your assets to further improve capital growth potential.
                                </p>
                                <p class="risk_desc risk_desc_5">
                                    You are an experienced or sophisticated investor. Security of capital is secondary to the pursuit of high investment returns. Your portfolio will comprise almost solely of growth assets and you are happy to accept the risks this involves.
                                </p>
                            </div>
                            <div style="width: 200px;margin: 0 auto;">
                                <div class="input_element clc_btn_component">
                                    <div class="calculate_btn" onclick="loadFirstPage()">
                                        Start Over
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <img class="img_1" src="{% static 'assets/images/LOGO_for_Munshi.svg' %}" alt="">
                    <img class="img_2_risk" src="{% static 'assets/images/Group17.svg' %}" alt="">
                    <img class="img_3_risk" src="{% static 'assets/images/Money.svg' %}" alt="">
                </div>
            </div>
        </div>
    </section>
    <section class="risl_appetite_mobile_images">
        <img class="img_1_mobile" src="{% static 'assets/images/LOGO_for_Munshi.svg' %}" alt="">
        <img class="img_2_risk_mobile" src="{% static 'assets/images/Group17.svg' %}" alt="">
        <img class="img_3_risk_mobile" src="{% static 'assets/images/Money.svg' %}" alt="">
    </section>


</body>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script>
    var currentPage = 1;
    function showPage(pageNumber) {

        // Remove existing error messages
        $(".error-message").remove(); 

        var hasErrors = false;
        if (pageNumber != '1'){
            if (currentPage == 1){


                // Validate required fields
                
                $(".required").each(function () {
                    var inputValue = $(this).val().trim();
                    if (inputValue === "") {
                        hasErrors = true;
                        //$(this).after('<span class="error-message" style="color: red; font-size: smaller;">This field is required</span>');
                        return false; // Exit the loop if an empty field is found
                    } else if (isNaN(inputValue)) {
                        hasErrors = true;
                        //$(this).after('<span class="error-message" style="color: red; font-size: smaller;">Please enter a valid number</span>');
                        return false; // Exit the loop if a non-numeric value is found
                    }
                });
                
                
                var isSelectEmpty = $('.required-select').val() === "";
                if (isSelectEmpty) {
                    hasErrors = true;
                }
                
                // If there are errors, display a message
                if (hasErrors) {
                    $("#error-message").text("Note - Please fill in all required fields.");
                    return false;
                } 
                else {
                    // Additional validations
                    $("#error-message").text("");

                    // Validate current age
                    var currentAge = parseInt($('#current_age').val(), 10);
                    if (isNaN(currentAge) || currentAge < 1 || currentAge > 80) {
                        hasErrors = true;
                        if (isNaN(currentAge)) {
                            $('.current-age-error-message').text('Please enter a valid number');
                        } else if (currentAge < 0) {
                            $('.current-age-error-message').text('Age cannot be negative');
                        } else {
                            $('.current-age-error-message').text('Please enter a valid age between 1 and 80');
                        }
                    }
                    else {
                        $('.current-age-error-message').text('');
                    }

                    // Validate income
                    var income = parseInt($('#income').val(), 10);
                    if (isNaN(income) || income < 0 || income > 9999999999) {
                        hasErrors = true;
                        if (isNaN(income)) {
                            $('.income-error-message').text('Please enter a valid amount');
                        } else if (income < 0) {
                            $('.income-error-message').text('Income cannot be negative');
                        } else {
                            $('.income-error-message').text('Please enter a valid income between 0 and 100 crores');
                        }
                    }
                    else {
                        $('.income-error-message').text('');
                    }


                    // Validate expenses
                    var expenses = parseInt($('#expenses').val(), 10);
                    if (isNaN(expenses) || expenses < 0 || expenses > 9999999999) {
                        hasErrors = true;
                        if (isNaN(expenses)) {
                            $('.expense-error-message').text('Please enter valid amount');
                        } else if (expenses < 0) {
                            $('.expense-error-message').text('Expenses cannot be negative');
                        } else {
                            $('.expense-error-message').text('Please enter valid expenses between 0 and 100 crores');
                        }
                    }
                    else {
                        $('.expense-error-message').text('');
                    }


                    // Validate investment_amount
                    var investment_amount = parseInt($('#investment_amount').val(), 10);
                    if (isNaN(investment_amount) || investment_amount < 0 || investment_amount > 9999999999) {
                        hasErrors = true;
                        if (isNaN(investment_amount)) {
                            $('.investment-error-message').text('Please enter valid amount');
                        } else if (investment_amount < 0) {
                            $('.investment-error-message').text('Investment cannot be negative');
                        } else {
                            $('.investment-error-message').text('Please enter valid Investment between 0 and 100 crores');
                        }
                    }
                    else {
                        $('.investment-error-message').text('');
                    }

                    // Validate dependents
                    var dependents = parseInt($('#dependents').val(), 10);
                    if (isNaN(dependents) || dependents < 0 || dependents > 99) {
                        hasErrors = true;
                        if (isNaN(dependents)) {
                            $('.dependents-error-message').text('Please enter a valid number');
                        } else if (dependents < 0) {
                            $('.dependents-error-message').text('Dependents cannot be negative');
                        } else {
                            $('.dependents-error-message').text('Please enter a valid number between 0 and 99');
                        }
                    }
                    else {
                        $('.dependents-error-message').text('');
                    }
                }
            }
        }
    
    if (hasErrors) {
        // Display error message if there are validation errors
        $("#error-message").text("Note - Please correct the errors.");
        return false;
    } else {

        // If no errors, proceed with page navigation
        $("#error-message").text("");
        // Hide all pages
        for (var i = 1; i <= 3; i++) {
            document.getElementById('page' + i).style.display = 'none';
        }
        // Show the selected page
        document.getElementById('page' + pageNumber).style.display = 'block';
        // Update the current page variable
        currentPage = pageNumber;
        return true;
    }
}

            
    function setPercentages(rangeVal, elemId) {
        document.getElementById(elemId).value = rangeVal.value;
    }

    function getSelectedRadioValue(questionName) {
        // Get the selected radio button value for a specific question
        var selectedOption = document.querySelector('input[name="' + questionName + '"]:checked');
        return selectedOption ? parseInt(selectedOption.value) : 0;
    }

    function calculateTotalPoints() {
        // Get the selected values for each question
        var q1Value = getSelectedRadioValue('q1');
        var q2Value = getSelectedRadioValue('q2');
        var q3Value = getSelectedRadioValue('q3');
        var q4Value = getSelectedRadioValue('q4');
        var q5Value = getSelectedRadioValue('q5');
        var q6Value = getSelectedRadioValue('q6');
        var currentAge = document.getElementById('current_age').value || 0;
        var expenses = document.getElementById('expenses').value || 0;
        var income = document.getElementById('income').value || 0;
        var investment = document.getElementById('investment_amount').value || 0;
        var dependents = document.getElementById('dependents').value || 0;
        var tier = document.getElementById('tier').value || 0;

        // Sum up the points for all questions
        var totalPoints = q1Value + q2Value + q3Value + q4Value + q5Value + q6Value;

        // Determine risk appetite category based on the provided ranges
        var riskAppetiteCategory = '';
        var riskAppetiteValue = 0;

        if (totalPoints >= 27) {
            riskAppetiteCategory = 'Highly Aggressive';
            riskAppetiteValue = 5;
        } else if (totalPoints >= 21 && totalPoints <= 26) {
            riskAppetiteCategory = 'Aggressive';
            riskAppetiteValue = 4;
        } else if (totalPoints >= 14 && totalPoints <= 20) {
            riskAppetiteCategory = 'Moderate';
            riskAppetiteValue = 3;
        } else if (totalPoints >= 8 && totalPoints <= 14) {
            riskAppetiteCategory = 'Conservative';
            riskAppetiteValue = 2;
        } else {
            riskAppetiteCategory = 'Highly Conservative';
            riskAppetiteValue = 1;
        }

        return { category: riskAppetiteCategory, value: riskAppetiteValue };

    }

    function calculateClick() {
        $('.output_section').hide();
        let current_age = document.getElementById('current_age') ? document.getElementById('current_age').value : 0;
        let expenses = document.getElementById('expenses') ? document.getElementById('expenses').value : 0;
        let income = document.getElementById('income') ? document.getElementById('income').value : 0;
        let investment_amount = document.getElementById('investment_amount') ? document.getElementById('investment_amount').value : 0;
      
        // Check if the value is empty, if yes then set it to 0
        current_age = current_age === '' ? 0 : current_age;
        expenses = expenses === '' ? 0 : expenses;
        income = income === '' ? 0 : income;
        investment_amount = investment_amount === '' ? 0 : investment_amount;
     
        let data = {
            age: parseInt(current_age),
            expenses: parseFloat(expenses),
            income: parseFloat(income),
            investment: parseFloat(investment_amount),
        }
        alert(data)
        var hasErrors = false;
        $(".required").each(function() {
            if ($(this).val().trim() === "") {
                hasErrors = true;
                return false; // Exit the loop if an empty field is found
            }
        });
        
        // If there are errors, display a message
        if (hasErrors) {
            $("#error-message").text("Note - Please fill in all required fields.");
        } else {
            $.ajax({
                url:"https://aiapp.wealthtech.ai/getriskappetite_api",
                method : "POST",
                data : JSON.stringify(data),
                success: function(resp){
                    if(resp.error_code == '100'){
                        $("#error-message").text('');
                        // $("#output").html(resp.final_retirement_age);
                        $('.risk_graph').css('transform','rotate(20deg)'); //20 50 93 140 180
                        $(".output").html(resp.data.risk_appetite);
                        $('.output_section').show();
                    }else{
                        $("#error-message").text("Note - Please fill in all required fields.");
                    }
                }
            });
        }

        console.log(data);
    }

    function submitForm() {
        var allQuestionsAnswered = false;
        var allQuestionsAnswered = $('.radio_button_option').find('input[type="radio"]:checked').length === $('.radio_question').length;
        if (!allQuestionsAnswered) {
            $("#error-message").text("Note - Please fill in all required fields.");
            $('html, body').animate({
                scrollTop: $("#error-message").offset().top
            }, 500);
        } else {
            // Calculate total points and determine risk appetite category
            var result = calculateTotalPoints();
            // Show the last page
            showPage(3);
            // Additional logic for displaying results on the last page if needed
            document.getElementById('output').innerText = result.category;
            $('.risk_desc_'+result.value).css('display','block');

            let current_age = document.getElementById('current_age') ? document.getElementById('current_age').value : 0;
            let expenses = document.getElementById('expenses') ? document.getElementById('expenses').value : 0;
            let income = document.getElementById('income') ? document.getElementById('income').value : 0;
            let investment = document.getElementById('investment_amount') ? document.getElementById('investment_amount').value : 0;
            let dependents = document.getElementById('dependents') ? document.getElementById('dependents').value : 0;
            let tier = document.getElementById('tier') ? document.getElementById('tier').value : 0;

            current_age = current_age === '' ? 0 : current_age;
            expenses = expenses === '' ? 0 : expenses;
            income = income === '' ? 0 : income;
            investment = investment === '' ? 0 : investment;
            dependents = dependents === '' ? 0 : dependents;
            tier = tier === '' ? 0 : tier;

            let data = {
                current_age: parseInt(current_age),
                expenses: parseFloat(expenses),
                income: parseFloat(income),
                investment: parseFloat(investment),
                dependents: parseFloat(dependents),
                tier: tier,
                riskAppetiteCategory: result.category,
                riskAppetiteValue: result.value,
            } 

            // Send the data to the server
            fetch('/save_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: JSON.stringify({'current_age':current_age, 'expenses':expenses, 'income':income, 'investment':investment, 'dependents':dependents, 'tier':tier, 'riskAppetiteCategory':result.category, 'riskAppetiteValue':result.value})
            })
            .then(response => response.json())
            .then(data => {
                // Handle the server response if needed
                console.log(data);
            })
            .catch(error => console.error('Error!', error.message));
        }
    }

    function loadFirstPage() {
        window.location.href = 'risk_appetite'; // Adjust the URL as needed
    }
</script>

</html>